!function(t,e,o){"object"==typeof exports?module.exports=t(e,o):"function"==typeof define&&define.amd?define(()=>t(e,o)):e.Noose=t(e,o)}((function(t,e){"use strict";function o(){}const s=Math.min,r=Math.max,n="px",i={classes:{noose:"noose",selected:"selected"},compute:!0,container:"body",containers:[],ctrl:!0,enabled:!0,mode:"touch",move:o,scroll:10,scrollEdge:10,scrollbar:17,select:"*",shift:!0,start:o,stop:o,style:{border:"1px dotted #000",zIndex:1e3},throttle:200};return class{constructor(o,l){const c=this;if("object"!=typeof o||null==o||o instanceof HTMLElement||(l=o,o=null),l=c.opts=Object.assign({},i,l),("string"==typeof o||o instanceof HTMLElement)&&(l.container=o),l.container instanceof HTMLElement)c.containers=[l.container];else{if("string"!=typeof l.container)throw new Error("Invalid container option");c.containers=Array.prototype.slice.call(e.querySelectorAll(l.container))}c.coors={pointer:{},noose:{},container:{}};const a=c.noose=e.createElement("div");a.style.position="absolute",a.style.zIndex=l.style.zIndex,a.style.border=l.style.border,l.classes.noose&&a.classList.add(l.classes.noose);let d=!1,u=!1;return c._onStart=function(e){const o=e.currentTarget===c.currentTarget;if(l.enabled&&(!d||!o)&&("mousedown"!==e.type||1===e.which)){d=!0;const n=c.currentTarget=e.currentTarget,i=c.coors.container,u=c.coors.pointer,p=c.coors.noose,h=t.getComputedStyle(n);"static"===h.position&&console.warn("Container is not a positioned element. This may cause issues positioning the noose and/or selecting elements."),l.scroll>0&&l.scrollEdge>0?(i.scrollX=("auto"===h.overflowX||"scroll"===h.overflowX)&&n.scrollHeight>n.clientHeight,i.scrollY=("auto"===h.overflowY||"scroll"===h.overflowY)&&n.scrollWidth>n.clientWidth):(i.scrollX=!1,i.scrollY=!1),i.maxScrollY=i.scrollY&&n.scrollHeight-n.clientHeight||0,i.maxScrollX=i.scrollX&&n.scrollWidth-n.clientWidth||0;const y=u.start,f=u.end;if(u.start=null,p.start=null,c.updateContainerPosition().updatePointerPosition(e),l.scrollbar&&(i.scrollX&&u.end.x>i.x+i.w-l.scrollbar||i.scrollY&&u.end.y>i.y+i.h-l.scrollbar))return d=!1,u.start=y,void(u.end=f);if(l.shift&&o&&e.shiftKey&&y){const t=p.top,e=p.bottom,o=Math.floor((y.x+f.x)/2),n=Math.floor((y.y+f.y)/2);p.start={},u.start.x>=o&&u.start.y<n?(u.start.x=s(y.x,f.x),u.start.y=r(y.y,f.y),p.start.x=t.x,p.start.y=e.y):u.start.x<o&&u.start.y<=n?(u.start.x=r(y.x,f.x),u.start.y=r(y.y,f.y),p.start=e):u.start.x<=o&&u.start.y>n?(u.start.x=r(y.x,f.x),u.start.y=s(y.y,f.y),p.start.x=e.x,p.start.y=t.y):u.start.x>o&&u.start.y>=n&&(u.start.x=s(y.x,f.x),u.start.y=s(y.y,f.y),p.start=t)}if(l.ctrl&&o&&e.ctrlKey?c.lastSelection=c.selected||[]:c.lastSelection=[],a.style.display="none",!1===l.start.apply(c,[e,c.coors]))return d=!1,u.start=y,void(u.end=f);n.appendChild(a)}},c._onMove=function(t){if(l.enabled&&d&&t.currentTarget===c.currentTarget){t.cancelable&&t.preventDefault(),"scroll"!==t.type&&c.updatePointerPosition(t),c.updateContainerPosition().updateNoosePosition();let e=c.coors.noose.top,o=c.coors.noose.bottom;a.style.left=e.x+n,a.style.top=e.y+n,a.style.width=o.x-e.x+n,a.style.height=o.y-e.y+n,a.style.display="block";let s=c.currentTarget,r=c.coors.container,i=c.coors.pointer.end;r.scrollY&&i.y-r.y<l.scrollEdge?s.scrollTop-=l.scroll:r.scrollY&&s.scrollTop<r.maxScrollY&&r.y+r.h-i.y<l.scrollEdge?s.scrollTop+=l.scroll:r.scrollX&&i.x-r.x<l.scrollEdge?s.scrollLeft-=l.scroll:r.scrollX&&s.scrollLeft<r.maxScrollX&&r.x+r.w-i.x<l.scrollEdge&&(s.scrollLeft+=l.scroll),l.compute&&(l.throttle?u||(u=!0,setTimeout((function(){u&&c.compute()&&l.move.apply(c,[t,c.coors,c.selected]),u=!1}),l.throttle)):(c.compute(),l.move.apply(c,[t,c.coors,c.selected])))}},c._onEnd=function(t){c.opts.enabled&&d&&("mouseup"!==t.type||1===t.which)&&(d=!1,t.currentTarget===c.currentTarget&&(c.updateContainerPosition().updatePointerPosition(t).updateNoosePosition(),u=!1,l.compute&&c.compute(!0),setTimeout((function(){l.stop.apply(c,[t,c.coors,c.selected])}),0),c.currentTarget.removeChild(a)))},c.containers.forEach(t=>{c._register(t)}),c}destroy(){const t=this;return t.containers.forEach(e=>{t._deregister(e)}),t.noose.remove(),t.noose=null,t}updateContainerPosition(){const e=this.coors.container,o=this.currentTarget.getBoundingClientRect();return e.x=o.left+t.pageXOffset,e.y=o.top+t.pageYOffset,e.w=o.width,e.h=o.height,this}updatePointerPosition(t){const e=t&&t.touches&&t.touches[0]||t,o=this.coors.pointer;return e&&"number"==typeof e.pageX&&(o.end={x:e.pageX,y:e.pageY},o.start||(o.start=o.end)),this}updateNoosePosition(){const t=this.currentTarget,e=this.coors.pointer.end,o=this.coors.container,n=this.coors.noose,i=r(e.x-o.x+t.scrollLeft,0),l=r(e.y-o.y+t.scrollTop,0);return n.start||(n.start={x:i,y:l}),n.top={x:s(n.start.x,i),y:s(n.start.y,l)},n.bottom={x:s(r(n.start.x,i),t.scrollWidth),y:s(r(n.start.y,l),t.scrollHeight)},this}compute(){const e=this;if(e.opts.select){const o=e.opts.classes.selected,s=e.currentTarget,r=s.querySelectorAll(e.opts.select),n=e.coors.noose.top,i=e.coors.noose.bottom,l=e.coors.container.x,c=e.coors.container.y;e.selected=[],Array.prototype.forEach.call(r,(function(r){if(r===e.noose)return;let a;const d=r.getBoundingClientRect(),u=d.left+t.pageXOffset-l+s.scrollLeft,p=d.top+t.pageYOffset-c+s.scrollTop,h=d.width+u,y=d.height+p;a="fit"===e.opts.mode?n.x<=u&&n.y<=p&&i.x>=h&&i.y>=y:!(n.x>h||n.y>y||i.x<u||i.y<p);const f=e.lastSelection.indexOf(r);a&&-1===f||!a&&-1!==f?(o&&r.classList.add(o),e.selected.push(r)):o&&r.classList.remove(o)}))}return e}_deregister(t){return t.removeEventListener("mousedown",this._onStart),t.removeEventListener("touchstart",this._onStart),t.removeEventListener("mousemove",this._onMove),t.removeEventListener("touchmove",this._onMove),t.removeEventListener("scroll",this._onMove),t.removeEventListener("mouseup",this._onEnd),t.removeEventListener("touchend",this._onEnd),delete t.noose,this}deregister(t){var e=this.containers.indexOf(t);return e>-1&&"function"==typeof t.removeEventListener&&(this._deregister(t),this.containers.splice(e,1)),this}_register(t){return t.addEventListener("mousedown",this._onStart),t.addEventListener("touchstart",this._onStart,!1),t.addEventListener("mousemove",this._onMove),t.addEventListener("touchmove",this._onMove,!1),t.addEventListener("scroll",this._onMove),t.addEventListener("mouseup",this._onEnd),t.addEventListener("touchend",this._onEnd,!1),t.noose=this}register(t){return-1===this.containers.indexOf(t)&&"function"==typeof t.addEventListener&&(this._register(t),this.containers.push(t)),this}static get version(){return"1.2.1"}}}),window,document);
//# sourceMappingURL=noose.js.map
